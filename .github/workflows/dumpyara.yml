name: DumprX

on:
  push:
    paths-ignore:
      - '*.md'
    branches: [ main ]

defaults:
  run:
    shell: bash

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
       - name: Checkouts
         uses: actions/checkout@v2

       - name: Clone Dumprx
         run: |
              git clone --depth=1 https://github.com/WisnuArdhi28/DumprX
              
              
       - name: Setup Dumprx environment
         working-directory: DumprX
         run: |
              bash setup.sh

       - name: Setup config envs And Begin Dump
         working-directory: DumprX
         run: |
              NAME_OF_THIS_REPO="dumper"
              GITHUB_ORG_NAME="gudang-dump"
              GITHUB_USERNAME="WisnuArdhi28"
              GIT_CONFIG_USERNAME="WisnuArdhi28"
              GIT_CONFIG_EMAIL="wisnuardi128@gmail.com"
              GIT_GITHUB_TOKEN="${{ secrets.GIT_GITHUB_TOKEN }}"
              TG_BOT_TOKEN="${{ secrets.TG_BOT_TOKEN }}"
              TG_CHAT="@gudang_dummper"
              # GITLAB_HOSTNAME="gitgud.io" ## use 'gitlab.com' by default, or use your own gitlab instance, or any public one
              echo "$GITHUB_ORG_NAME" > .github_orgname
              # echo "$GITLAB_HOSTNAME" > .gitlab_instance
              echo "$GIT_GITHUB_TOKEN" > .github_token
              # echo "$GITLAB_ORG_NAME" > .gitlab_orgname
              # echo "$GITLAB_USERNAME" > .gitlab_username
              echo "$GITHUB_USERNAME" > .github_username
              # echo "$GITLAB_TOKEN" > .gitlab_token
              # echo "$CHAT_REQUEST_ID" > .tg_request_chat
              echo "$TG_BOT_TOKEN" > .tg_token
              echo "$TG_CHAT" > .tg_chat
              aria2c -o .tg_chat_id https://raw.githubusercontent.com/${GITHUB_USERNAME}/${NAME_OF_THIS_REPO}/main/CHAT_ID.txt
              aria2c -o .user_first_name https://raw.githubusercontent.com/${GITHUB_USERNAME}/${NAME_OF_THIS_REPO}/main/USER_FIRST_NAME.txt
              aria2c -o .user_id https://raw.githubusercontent.com/${GITHUB_USERNAME}/${NAME_OF_THIS_REPO}/main/USER_ID.txt
              aria2c -o .user_tag https://raw.githubusercontent.com/${GITHUB_USERNAME}/${NAME_OF_THIS_REPO}/main/USER_TAG.txt
              #Do Not Edit This
              git config --global user.name "$GIT_CONFIG_USERNAME"
              git config --global user.email "$GIT_CONFIG_EMAIL"
              #Send Telegram Conformation  #Sends A 'Starting Dump...' Message, and saves the message id to a file, so that, message can be edited live later on
              echo ""$(curl -X POST -H 'Content-Type: application/json' -d "{\"chat_id\": \"$(< .tg_chat_id)\", \"text\": \"Starting Dump...\", \"disable_notification\": true}" https://api.telegram.org/bot$TG_BOT_TOKEN/sendMessage | grep -oP "(\"message_id\":)[0-9]+" | cut -d ":" -f 2)"" > .message_id
              bash dumper.sh "$ROM_URL"

env:
  ROM_URL: https://doc-04-a8-docs.googleusercontent.com/docs/securesc/vq0188is6l2vhl8ec6dcla95nn6j6pe1/5274mk91u02cs5iktkjfjnq8toenqrua/1671811425000/16339791011158475891/09906225666411368056/1meH6bgulWFmEBeEzoQt5YGiVFkWbNwdV?e=download&ax=ALjR8szuGPtboxZC8k1As2bpOg7gvE9netSHLkMRdb8k6PbnoBLXahd6AbZb0y1sgj9goVeJ0ysD-7HaMcqotPJ3_kwO_CxS0jToyNDKfVaGGp6i5_WC2_pHkJVThHKNNIm3MIDNRM_qMnS5rJNVOUOwvIltkNuXI9u8vGJIKQZ3FLtAP6fvpIL1k0GaeVEUQbldce_o76vRrN6Qp4XOqHKAk7nVLtMi76JNoOImG46T9054elbHc-BNkKr34bjtpBWlngZEzwuTg7lKGTn22Y7ibghAN6bvIuN7yqMrQvHLWXs-Bc234eWBtYlVM4QR5skrZdZn3wH7J15lBUHWJ_14-RIaC1wOV6obdd8gN27XcXIPOn94F9uDAUnQhxhOBvtE-O11hRJFR1hsKgSPDP73Hs7SzDWJqXS4iWKp7zw05EYO2Z0hf2PJsaKM7jU9FlBDPA1GkfXzLXz5A4W7GOnA975iCh7ohF-Y6fQ66fHYA7naUyzng3AxcA-QLtL86CkEq-LyCbK9iI3w9Jbb-3LYBhTcjL7vw7dWW7tkRzBZ-Hr_HAJbo5psb-wqQhbD4njUytTosnbXDpG42EBpGVopaiTtSmYCntj2ksAecBeLwY8ABcEvLLysZGpXoKB_LlwXK403ZxisE03nqWs6BGGNJaxSnmroeXv9mTk1GAx4iv8C7BjG1JBb68Ne0ilnRYVk07KYPPvHU0vFIG-LZJwTM8iac4L4PDH3tl87KUGs4qQXnR3PXAx3HHlPSuxrYTTl816kQVQv_6xaKGd_CHR01XCdfYEZXvFSxMcHbti657s5Xo1OOMxunUaaC0J-wglGOzW-r-4x5D1u4XiXZNZwLE91Vq3ALYMLmC9Qru1q25KPDqTk49SfUdjVKa2v8Nk0ng&uuid=45481b0d-b4be-4081-ab8d-c96cafbb5adc&authuser=0&nonce=v8p0jcea924ha&user=09906225666411368056&hash=adad00umpquuf7ngchcmg8dfgjtq0s3f
